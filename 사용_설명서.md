# Action Bundle Manager 사용 설명서

## 목차

1. [시작하기](#시작하기)
2. [홈 화면](#홈-화면)
3. [액션 번들 생성](#액션-번들-생성)
4. [액션 번들 수정](#액션-번들-수정)
5. [메모 관리](#메모-관리)
6. [검색 기능](#검색-기능)
7. [CSV 가져오기](#csv-가져오기)
8. [CSV 내보내기](#csv-내보내기)
9. [액션 번들 삭제](#액션-번들-삭제)
10. [링크 탭](#링크-탭)
11. [데이터 세트 구성](#데이터-세트-구성)
12. [자주 묻는 질문](#자주-묻는-질문)

---

## 시작하기
- uvicorn app.main:app --reload
- http://127.0.0.1:8000 클릭

### 애플리케이션 접속

1. 웹 브라우저를 엽니다 (Chrome, Edge, Firefox 등)
2. 주소창에 `http://127.0.0.1:8000` 입력
3. Enter 키를 누르면 Action Bundle Manager 홈 화면이 표시됩니다

### 화면 구성

- **상단 헤더**: 앱 제목과 주요 메뉴
- **메인 영역**: 번들 목록 또는 상세 정보 표시
- **툴바**: 검색 및 CSV 가져오기 기능

---

## 홈 화면

홈 화면은 **데이터 세트 탭**과 **뷰 탭**을 기반으로 동작합니다. 원하는 세트를 선택한 뒤, 번들 카드 또는 링크 탭으로 전환하며 작업합니다.

### 화면 요소

1. **데이터 세트 탭**
   - 상단 첫 번째 탭 행에서 `세트 A`, `세트 B` 등 정의된 세트를 전환합니다.
   - 각 세트는 메인/메모/링크 CSV 세트 3종을 독립적으로 보유합니다.

2. **뷰 탭**
   - 두 번째 탭 행에서 `Bundles`, `Links` 중 원하는 뷰를 선택합니다.
   - `Bundles`는 액션 번들을, `Links`는 URL 목록을 표시합니다.

3. **검색 & 키워드 칩 (Bundles 전용)**
   - Bundle Name 또는 Keywords 기준 필터링.
   - 하단 추천 키워드를 클릭하면 검색창에 자동입력되어 바로 필터링됩니다.

4. **번들 카드**
   - 카드에는 `Bundle Name`, `Part`, 분해된 `Command` 목록만 표시됩니다.
   - 이름을 클릭하면 상세 페이지로 이동합니다.

5. **링크 관리자 (Links 전용)**
   - URL / Description / Tags 입력 후 저장하면 해당 세트의 링크 CSV에 기록됩니다.
   - 목록 테이블에서 삭제하거나 새 창으로 열 수 있습니다.

### 번들 카드 클릭

번들 카드의 번들 이름을 클릭하면 해당 번들의 상세 페이지로 이동합니다.

---

## 액션 번들 생성

### 1단계: 새 번들 페이지 접속

- 홈 화면 헤더의 `+ New Bundle` 링크 클릭
- 또는 주소창에 `/bundle/new` 입력

### 2단계: 정보 입력

#### 필수 입력 항목

- **Part**: 부품 또는 영역 이름 (예: "Engine", "Transmission", "Electrical")
- **Bundle Name**: 번들 이름 (예: "Engine Overheat Diagnosis")

#### 선택 입력 항목

- **Command**: 명령어 입력
  - 한 줄에 하나의 명령어 입력
  - 여러 명령어는 줄바꿈으로 구분
  - 예시:
    ```
    check engine temperature
    inspect coolant level
    verify fan operation
    ```
  - 입력하면 오른쪽에 "Command Preview"가 실시간으로 표시되어 분해된 명령어를 확인할 수 있습니다
- **Keywords**: 검색에 사용할 키워드 (쉼표로 구분, 예: "overheat, engine, temperature")
- **Description**: 번들 전체가 아니라 **각 명령어별**로 Command Memo 섹션에서 입력합니다.

### 3단계: 저장

- `Save Bundle` 버튼 클릭
- 저장되면 자동으로 번들 상세 페이지로 이동합니다
- Command 필드에 입력한 명령어들이 자동으로 개별 Command ID로 분해되어 메모 섹션에 표시됩니다

---

## 액션 번들 수정

### 1단계: 번들 선택

- 홈 화면에서 수정할 번들 카드의 이름 클릭
- 번들 상세 페이지로 이동

### 2단계: 정보 수정

상세 페이지 상단의 폼에서 다음 정보를 수정할 수 있습니다:

- **Part**: 부품/영역
- **Bundle Name**: 번들 이름
- **Keywords**: 검색용 키워드
- **Command**: 명령어 (여러 줄 가능)
  - 명령어를 수정하면 "Commands detected: N" 메시지로 분해된 명령어 개수가 표시됩니다
  - 저장 시 자동으로 메모 항목이 동기화됩니다

### 3단계: 저장

- `Update Bundle` 버튼 클릭
- 변경사항이 저장되고 페이지가 새로고침됩니다

### 주의사항

- Command 필드를 수정하면 메모 섹션의 Command ID가 자동으로 재정렬됩니다
- 기존 메모는 유지되지만, 명령어가 삭제되면 해당 메모도 함께 삭제됩니다
- 명령어가 추가되면 새로운 메모 항목이 생성됩니다

---

## 메모 관리

각 명령어에 대한 메모와 OneNote 링크를 관리할 수 있습니다.

### 메모 섹션 위치

번들 상세 페이지 하단에 "Command Memos" 섹션이 있습니다.

### 메모 테이블 구조

| # | Command | Description | Memo | OneNote Link |
|---|---------|-------------|------|--------------|
| 1 | 명령어 텍스트 | 설명 입력란 | 메모 입력란 | 링크 입력란 |
| 2 | 명령어 텍스트 | 설명 입력란 | 메모 입력란 | 링크 입력란 |

- **#**: Command ID (명령어 순서)
- **Command**: 분해된 명령어 텍스트 (읽기 전용)
- **Description**: 해당 명령어에 대한 설명/의도
- **Memo**: 실행 중 생긴 메모나 관찰 내용
- **OneNote Link**: 추가 문서나 자료에 대한 URL

### 메모 입력 방법

1. 각 명령어 행의 "Description"에 설명, "Memo"에 기록을 입력
2. 필요시 "OneNote Link" 입력란에 OneNote 페이지 링크 입력
3. 모든 입력 완료 후 `Save Memo Updates` 버튼 클릭
4. 저장되면 데이터베이스와 CSV에 반영됩니다

### 메모 작성 팁

- 각 명령어 실행 시 주의사항, 결과, 추가 정보 등을 기록
- OneNote 링크는 관련 문서나 상세 정보가 있는 페이지로 연결
- 메모는 나중에 CSV로 내보낼 수 있습니다

---

## 검색 기능

### 검색 방법

1. 홈 화면 상단의 검색창에 검색어 입력
2. `Search` 버튼 클릭 또는 Enter 키 입력
3. Bundle Name 또는 Keywords에 검색어가 포함된 번들만 표시됩니다

### 검색 예시

- "engine" 입력 → Bundle Name이나 Keywords에 "engine"이 포함된 모든 번들 표시
- "overheat" 입력 → "overheat" 관련 번들만 필터링

### 검색 초기화

- 검색창을 비우고 `Search` 버튼 클릭
- 또는 검색창을 비운 후 Enter 키 입력

---

## CSV 가져오기

기존 CSV 파일을 가져와서 데이터를 업데이트하거나 추가할 수 있습니다.

### 메인 CSV 가져오기

1. 홈 화면 상단의 "Main CSV" 섹션에서 `파일 선택` 클릭
2. CSV 파일 선택 (컬럼: ID, Part, Bundle Name, Command, Keywords)
3. `Import` 버튼 클릭
4. 가져오기 완료 후 홈 화면으로 리다이렉트됩니다

**동작 방식:**
- ID가 일치하는 번들은 업데이트됩니다
- 새로운 ID는 새 번들로 생성됩니다
- Command 필드가 변경되면 자동으로 메모 항목이 동기화됩니다

### 메모 CSV 가져오기

1. 홈 화면 상단의 "Memo CSV" 섹션에서 `파일 선택` 클릭
2. CSV 파일 선택 (컬럼: ID, Command ID, Command Text, Description, Memo text, onenote link)
3. `Import` 버튼 클릭
4. 가져오기 완료 후 홈 화면으로 리다이렉트됩니다

**동작 방식:**
- 해당 액션 번들(ID)의 기존 메모가 모두 삭제됩니다
- 가져온 메모로 완전히 교체됩니다
- ID가 존재하지 않는 경우 해당 메모는 무시됩니다

### CSV 파일 형식 요구사항

#### 메인 CSV 필수 컬럼
- ID (정수)
- Part (문자열)
- Bundle Name (문자열)
- Command (문자열, 여러 줄 가능)
- Keywords (문자열)

#### 메모 CSV 필수 컬럼
- ID (액션 번들 ID, 정수)
- Command ID (명령어 순서, 정수, 1부터 시작)
- Command Text (문자열)
- Description (문자열)
- Memo text (문자열)
- onenote link (URL 문자열)

---

## CSV 내보내기

선택된 데이터 세트의 데이터를 CSV 파일(메인/메모/링크)로 다운로드할 수 있습니다. 파일 이름 앞에는 현재 세트의 ID가 자동으로 붙습니다(`set_a_action_bundles.csv` 등).

### 메인 CSV 내보내기

1. 헤더 메뉴에서 `Export Main CSV` 클릭
2. `<세트ID>_action_bundles.csv` 파일이 자동 다운로드됩니다
3. 다운로드 폴더에서 파일 확인

### 메모 CSV 내보내기

1. 헤더 메뉴에서 `Export Memo CSV` 클릭
2. `<세트ID>_command_memos.csv` 파일이 자동 다운로드됩니다

### 링크 CSV 내보내기

1. 헤더 메뉴에서 `Export Link CSV` 클릭
2. `<세트ID>_links.csv` 파일이 자동 다운로드됩니다
3. 다운로드 폴더에서 파일 확인

### 내보낸 CSV 활용

- Excel이나 다른 스프레드시트 프로그램에서 열어 편집 가능
- 백업 용도로 사용
- 다른 시스템으로 데이터 이전
- 수정 후 다시 가져오기 가능

---

## 액션 번들 삭제

### 삭제 방법

1. 삭제할 번들의 상세 페이지로 이동
2. 상단 오른쪽의 빨간색 `Delete` 버튼 클릭
3. 확인 대화상자에서 `확인` 클릭
4. 삭제되면 홈 화면으로 리다이렉트됩니다

### 주의사항

- 삭제된 번들은 복구할 수 없습니다
- 번들을 삭제하면 해당 번들의 모든 메모도 함께 삭제됩니다
- 삭제 전에 CSV로 내보내서 백업하는 것을 권장합니다

---

## 링크 탭

링크 탭은 각 데이터 세트별로 참고 URL을 모아두는 공간입니다.

### 주요 기능

1. **링크 추가**: URL, Description, Tags 입력 후 `링크 추가`를 누르면 해당 세트의 링크 CSV에 기록됩니다. 필요시 특정 번들(또는 명령어)과 연동할 수 있습니다.
2. **설명 필드**: URL에 대한 배경 설명이나 사용 시나리오를 자유롭게 남길 수 있습니다.
3. **태그 관리**: 쉼표로 구분된 태그를 입력해 나중에 필터링하거나 외부 도구에서 재분류할 수 있습니다.
4. **번들 연결**: 홈 화면의 링크 탭에서는 번들 단위 연결, 번들 상세 페이지에서는 Command를 선택해 세부 링크를 추가할 수 있습니다.
5. **빠른 이동**: URL을 클릭하면 새 탭에서 링크가 열립니다.
6. **삭제**: 행 우측의 `삭제` 버튼으로 개별 링크를 제거할 수 있습니다.

### CSV 저장 위치

링크 데이터는 `app/datasets.json`에서 정의한 `link_csv` 파일에 저장됩니다. 세트마다 파일명이 다르므로 원할 때 자유롭게 변경할 수 있습니다. CSV 컬럼은 `ID, Bundle ID, Command ID, URL, Description, Tags` 순서입니다.

---

## 데이터 세트 구성

### 개요

- 앱은 최대한 변경을 한 파일에서 관리할 수 있도록 `app/datasets.json` 설정 파일을 사용합니다.
- 각 항목은 `id`, `label`, `main_csv`, `memo_csv`, `link_csv`를 가지며, 이 네 값만 수정하면 새 세트 추가·파일명 변경이 가능합니다.
- 기본적으로 `세트 A`, `세트 B` 두 세트가 포함되어 있습니다.

### 설정 방법

1. `app/datasets.json` 파일을 엽니다.
2. 필요한 만큼 객체를 추가하거나 기존 값을 수정합니다.
3. `id`는 URL 파라미터와 파일명 접두사로 사용되므로 영문 소문자/숫자 조합을 권장합니다.
4. `label`은 화면 상단 탭에 표시될 이름입니다.
5. `*_csv` 값은 `app/` 디렉터리를 기준으로 한 상대 경로입니다. (예: `"set_c_main.csv"`)
6. FastAPI 서버를 재시작하면 새 설정이 반영됩니다.

### 예시

```json
{
  "datasets": [
    {
      "id": "lab",
      "label": "랩 환경",
      "main_csv": "lab_main.csv",
      "memo_csv": "lab_memos.csv",
      "link_csv": "lab_links.csv"
    },
    {
      "id": "prod",
      "label": "프로덕션",
      "main_csv": "prod_main.csv",
      "memo_csv": "prod_memos.csv",
      "link_csv": "prod_links.csv"
    }
  ]
}
```

---

## 자주 묻는 질문

### Q1: 명령어를 여러 개 입력하려면?

**A:** Command 필드에 한 줄에 하나씩 입력하세요. 줄바꿈으로 구분하면 자동으로 개별 Command ID로 분해됩니다.

예시:
```
check temperature
inspect coolant
verify fan
```

### Q2: 메모를 입력하지 않아도 되나요?

**A:** 네, 메모는 선택사항입니다. 나중에 필요할 때 추가할 수 있습니다.

### Q3: CSV를 가져온 후 기존 데이터는 어떻게 되나요?

**A:** 
- **메인 CSV**: ID가 일치하면 업데이트, 새로운 ID는 추가
- **메모 CSV**: 해당 번들의 기존 메모는 모두 삭제되고 새로 가져온 메모로 교체

### Q4: Command 필드를 수정하면 메모가 사라지나요?

**A:** 
- 명령어가 삭제되면 해당 Command ID의 메모도 함께 삭제됩니다
- 명령어 순서가 바뀌면 메모는 유지되지만 Command ID가 재정렬됩니다
- 새로운 명령어가 추가되면 빈 메모 항목이 생성됩니다

### Q5: 검색이 제대로 작동하지 않아요

**A:** 
- Bundle Name 또는 Keywords 필드에 검색어가 포함되어 있어야 합니다
- 대소문자는 구분하지 않습니다
- 부분 일치 검색이 가능합니다

### Q6: Description은 어디에서 입력하나요?

**A:** 
- 번들 생성/수정 폼에서는 Keywords와 Command만 관리합니다.
- 각 명령어별 Description은 번들 상세 페이지의 `Command Memos` 섹션에서 입력합니다.
- 메모 CSV를 내보내면 Description 값도 함께 포함됩니다.

### Q7: OneNote 링크는 어떻게 얻나요?

**A:** 
- OneNote에서 페이지를 열고
- 우클릭 → "페이지 링크 복사" 또는 "링크 복사"
- 복사한 링크를 OneNote Link 필드에 붙여넣기

### Q8: 데이터를 백업하려면?

**A:** 
- 정기적으로 `Export Main CSV`와 `Export Memo CSV`를 실행하여 백업하세요
- 다운로드한 CSV 파일을 안전한 위치에 보관하세요

### Q9: 여러 명령어를 한 번에 수정할 수 있나요?

**A:** 
- Command 필드에서 모든 명령어를 한 번에 수정할 수 있습니다
- 저장하면 자동으로 메모 항목이 동기화됩니다
- 개별 메모는 메모 섹션에서 수정하세요

### Q10: 키워드는 어떻게 입력하나요?

**A:** 
- 쉼표로 구분하여 여러 키워드를 입력할 수 있습니다
- 예: "engine, overheat, temperature, diagnosis"
- 공백은 자동으로 처리됩니다

---

## 문제 해결

### 페이지가 로드되지 않아요

- 애플리케이션이 실행 중인지 확인하세요
- 브라우저 주소가 `http://127.0.0.1:8000`인지 확인하세요
- 브라우저를 새로고침해보세요 (F5 또는 Ctrl+R)

### CSV 가져오기가 실패해요

- CSV 파일 형식이 올바른지 확인하세요
- 필수 컬럼이 모두 있는지 확인하세요
- 파일 인코딩이 UTF-8인지 확인하세요
- Excel에서 저장할 때 "CSV UTF-8(쉼표로 분리)" 형식으로 저장하세요

### 메모가 저장되지 않아요

- `Save Memo Updates` 버튼을 클릭했는지 확인하세요
- 번들 정보를 먼저 저장한 후 메모를 입력하세요
- 페이지를 새로고침하고 다시 시도해보세요

### 명령어가 제대로 분해되지 않아요

- 각 명령어가 줄바꿈으로 구분되어 있는지 확인하세요
- 빈 줄은 무시됩니다
- 명령어 앞뒤 공백은 자동으로 제거됩니다

---

## 추가 팁

### 효율적인 사용 방법

1. **일관된 명명 규칙**: Bundle Name과 Keywords를 일관되게 사용하면 검색이 쉬워집니다
2. **정기적인 백업**: 주기적으로 CSV를 내보내서 백업하세요
3. **상세한 메모**: 각 명령어에 대한 메모를 상세히 작성하면 나중에 참고하기 좋습니다
4. **OneNote 연동**: 관련 문서를 OneNote에 정리하고 링크를 연결하면 정보 관리가 효율적입니다
5. **Keywords 활용**: 검색을 쉽게 하기 위해 관련 키워드를 모두 입력하세요

### 워크플로우 예시

1. 새 문제 발생 → 번들 생성
2. 진단 명령어 입력 → 자동으로 Command ID 분해
3. 각 명령어 실행 → 결과를 메모에 기록
4. OneNote에 상세 문서 작성 → 링크 연결
5. 완료 후 CSV로 내보내기 → 백업

---

**문의사항이나 문제가 발생하면 개발팀에 문의하세요.**

